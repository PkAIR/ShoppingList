<!DOCTYPE html>
<html>

<head>
    <title>Shopping List Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
</head>

<body>
    <nav>
        <div class="nav-wrapper">
            <a class="brand-logo center">Shopping List</a>
        </div>
    </nav>
    <h4 class="right-align" style="visibility: visible;">No Items To Display</h4>
    <ul></ul>
</body>

<script>
    const electron = require('electron');
    const {
        ipcRenderer
    } = electron;

    ipcRenderer.on('items:upload', (event, data) => {
        let lastIndex = -1;
        let todoList = data._dictOfItems;
        if (data._dictOfItems == {}) {
            changeHeaderTo(HEADER_NO_ELEMS);
        }
        
        for (var guid in data._dictOfItems) {
            addNewItem(guid, data._dictOfItems[guid]);
        }        
    })

    const ul = document.querySelector('ul');
    const HEADER_NO_ELEMS = 'No Items To Display';
    const MAIN_HEADER = 'Here we go:';

    ipcRenderer.on('item:add', (e, guid, item) => {
        addNewItem(guid, item);
    });

    ipcRenderer.on('item:clear', (e, item) => {
        ul.className = '';
        ul.innerHTML = '';
        changeHeaderTo(HEADER_NO_ELEMS);
        e.sender.send('items:flush', item);
    });

    ul.addEventListener('dblclick', removeItem);

    function removeItem(e) {
        let valueToDelete = e.target.getAttribute('guid');
        ipcRenderer.send('item:delete', valueToDelete);
        e.target.remove();
        if (ul.children.length == 0) {
            ul.className = '';
            changeHeaderTo(HEADER_NO_ELEMS);
        }
    };

    function addNewItem(guid, item) {
        const li = document.createElement('li');
        const itemText = document.createTextNode(item);
        li.appendChild(itemText);
        li.setAttribute("guid", guid);
        ul.appendChild(li);
        changeHeaderTo(MAIN_HEADER);
        ul.className = 'collection';
        li.className = 'collection-item';
    }

    function changeHeaderTo(text) {
        var header = document.querySelector("h4");
        if (text === MAIN_HEADER) {
            header.className = 'left-align';
            header.textContent = MAIN_HEADER;
        }
        if (text === HEADER_NO_ELEMS) {
            header.className = 'right-align';
            header.textContent = HEADER_NO_ELEMS;
        }
    }
</script>

</html>